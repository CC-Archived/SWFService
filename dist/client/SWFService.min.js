/*!
 * [SWFService](http://github.com/CodeCatalyst/SWFService) v2.0.0
 * Copyright (c) 2008-2013 [CodeCatalyst, LLC](http://codecatalyst.com)
 * Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
 */
(function(){var a,b,f,e,d,c;d=(typeof process!=="undefined"&&process!==null?process.nextTick:void 0)!=null?process.nextTick:typeof setImmediate!=="undefined"&&setImmediate!==null?setImmediate:function(g){return setTimeout(g,0)};e=function(g){return typeof g==="function"};f=(function(){function g(t,h){var j,q,p,l,s,r,o,i,k,n,m;this.promise=new b(this);o=[];k=false;l=false;r=null;s=null;if(!e(h)){h=function(u){throw u}}n=function(){var v,w,u;for(w=0,u=o.length;w<u;w++){v=o[w];v[s](r)}o=[]};m=function(u){o.push(u);if(l){n()}};j=function(v,u){t=h=null;s=v;r=u;l=true;n()};p=function(u){j("resolve",u)};q=function(u){j("reject",u)};i=function(w,v){k=true;try{if(e(w)){v=w(v)}if(v&&e(v.then)){v.then(p,q)}else{p(v)}}catch(u){q(u)}};this.resolve=function(u){if(!k){i(t,u)}};this.reject=function(u){if(!k){i(h,u)}};this.then=function(w,u){var v;if(e(w)||e(u)){v=new g(w,u);d(function(){return m(v)});return v.promise}return this.promise}}return g})();b=(function(){function g(h){this.then=function(j,i){return h.then(j,i)}}return g})();a=(function(){function g(){var h;h=new f();this.promise=h.promise;this.resolve=function(i){return h.resolve(i)};this.reject=function(i){return h.reject(i)}}return g})();c=typeof exports!=="undefined"&&exports!==null?exports:window;c.Deferred=a;c.defer=function(){return new a()}}).call(this);(function(){var b,e,f,a,d,i,c,g,j,h;j=(function(){function k(m){var l,n;l=function(){return new Date().getTime()};n=l();this.elapsed=function(){return l()-n};this.remaining=function(){return Math.max(m-this.elapsed(),0)};this.expired=function(){return this.elapsed()>m}}return k})();e=(function(){function k(l,m){this.entityClass=l;this.entityKeyProperty=m!=null?m:"id";this.entitiesByKey={}}k.prototype.add=function(l){var m;if(!(l instanceof this.entityClass)){throw new Error("Entity must be of type: "+this.entityClass.name+" to be added to this EntitySet.")}m=l[this.entityKeyProperty];if(this.exists(m)){throw new Error("An Entity with key: "+m+" already exists in this EntitySet.")}this.entitiesByKey[m]=l;return l};k.prototype.remove=function(l){if(this.contains(l)){delete this.entitiesByKey[l[this.entityKeyProperty]];return l}return null};k.prototype.removeAll=function(){this.entitiesByKey={}};k.prototype.get=function(l){return this.entitiesByKey[l]};k.prototype.find=function(l){var m;m=function(n){var p,o;for(p in l){o=l[p];if(n[p]!==o){return false}}return true};return this.match(m)};k.prototype.match=function(n){var l,m,p,o;p=[];o=this.entitiesByKey;for(m in o){l=o[m];if(n(l)){p.push(l)}}return p};k.prototype.contains=function(l){var m;m=l[this.entityKeyProperty];return this.exists(m)&&l===this.get(m)};k.prototype.exists=function(l){return this.entitiesByKey[l]!=null};k.prototype.toArray=function(){var o,l,m,n;o=[];n=this.entitiesByKey;for(m in n){l=n[m];o.push(l)}return o};return k})();b=(function(){function k(l,m){this.entityClass=l;this.entityKeyProperty=m!=null?m:"id";this.entities=new e(this.entityClass);this.pendingEntityRequestsByEntityId={}}k.prototype.get=function(n,p){var m,l,o,q=this;l=this.entities.get(n);if(l!=null){m=new Deferred();m.resolve(l);return m.promise}else{m=new Deferred();if(p!=null){setTimeout(function(){m.reject(new Error("Request for "+q.entityClass.name+" with "+q.entityKeyProperty+': "'+n+'" timed out.'))},p)}if((o=this.pendingEntityRequestsByEntityId)[n]==null){o[n]=[]}this.pendingEntityRequestsByEntityId[n].push(m);return m.promise}};k.prototype.register=function(n){var o,m,p,q,l;this.entities.add(n);o=n[this.entityKeyProperty];p=this.pendingEntityRequestsByEntityId[o];for(q=0,l=p.length;q<l;q++){m=p[q];m.resolve(n)}delete this.pendingEntityRequestsByEntityId[o];return n};k.prototype.unregister=function(l){this.entities.remove(l);return l};return k})();g=(function(){function k(A,w,u){var m,l,y,v,s,x,p,o,n,z,C,B,t,r,q;this.id=w;l=function(D){return function(){return A.getServiceProperty(w,D)}};v=function(D){return function(E){A.setServiceProperty(w,D,E)}};y=function(D){return function(){var E;E=Array.prototype.slice.call(arguments);return A.executeServiceMethod(w,D,E)}};t=u.accessors;for(p=0,z=t.length;p<z;p++){m=t[p];Object.defineProperty(this,m.name,{writeable:m.access!=="readonly",get:l(m.name),set:v(m.name)})}r=u.variables;for(o=0,C=r.length;o<C;o++){x=r[o];Object.defineProperty(this,x.name,{get:l(x.name),set:v(x.name)})}q=u.methods;for(n=0,B=q.length;n<B;n++){s=q[n];this[s.name]=y(s.name)}if(u.isEventDispatcher){this.addEventListener=function(F,G,D,E,H){if(D==null){D=false}if(E==null){E=0}if(H==null){H=false}A.addServiceEventListener(w,F,G,D,E,H)};this.removeEventListener=function(E,F,D){if(D==null){D=false}A.removeServiceEventListener(w,E,F,D)}}}return k})();c=(function(){function k(p,o,m,n){var l;this.id=p;this.serviceId=o;this.methodName=m;this.args=n;l=new Deferred();this.promise=l.promise,this.resolve=l.resolve,this.reject=l.reject}return k})();i=(function(){function k(r,p,n,q,l,m,o){this.id=r;this.serviceId=p;this.eventType=n;this.listenerFunction=q;this.useCapture=l!=null?l:false;this.priority=m!=null?m:0;this.useWeakReference=o!=null?o:false}k.prototype.redispatch=function(l){return this.listenerFunction(l)};return k})();a=(function(){function k(l){this.id=l;this.serviceProxyRegistry=new b(g);this.serviceOperationProxies=new e(c);this.serviceEventListenerProxies=new e(i);return}k.prototype.get=function(m,l){return this.serviceProxyRegistry.get(m,l)};k.prototype.getServiceDescriptor=function(l){return this.swf.SWFServiceContext_getServiceDescriptor(l)};k.prototype.getServiceProperty=function(m,l){return this.swf.SWFServiceContext_getServiceProperty(m,l)};k.prototype.setServiceProperty=function(n,l,m){this.swf.SWFServiceContext_setServiceProperty(n,l,m)};k.prototype.executeServiceMethod=function(q,m,n){var p,o,l,r=this;o=this.swf.SWFServiceContext_executeServiceMethod(q,m,n);if(o.pending){l=new c(o.operationId,q,m,n);this.serviceOperationProxies.add(l);p=function(){return r.serviceOperationProxies.remove(l)};l.promise.then(p,p);return l.promise}return o.value};k.prototype.addServiceEventListener=function(p,o,q,l,n,r){var m;m=this.swf.SWFServiceContext_addServiceEventListener(p,o,l,n,r);this.serviceEventListenerProxies.add(new i(m,p,o,q,l,n,r))};k.prototype.removeServiceEventListener=function(o,m,p,l){var n;n=this.serviceEventListenerProxies.find({serviceId:o,eventType:m,listenerFunction:p,useCapture:l})[0];if(n!=null){this.swf.SWFServiceContext_removeServiceEventListener(o,n.id);this.serviceEventListenerProxies.remove(n)}};k.prototype.onServiceRegister=function(m,l){this.serviceProxyRegistry.register(new g(this,m,l))};k.prototype.onServiceExecuteComplete=function(p,m,o,n){var l;l=this.serviceOperationProxies.get(m);if(l!=null){l[o](n)}};k.prototype.onServiceEvent=function(n,l,m){return this.serviceEventListenerProxies.get(l).redispatch(m)};return k})();d=(function(){function k(){this.serviceContexts=new e(a)}k.prototype.add=function(l){return this.serviceContexts.add(l)};k.prototype.getById=function(l){return this.serviceContexts.get(l)};k.prototype.getBySWFId=function(m,o){var l,n,q,p=this;l=new Deferred();q=new j(o);n=setInterval(function(){var r,t,v,s;try{s=document.getElementById(m);v=s.SWFServiceContext_getId();t=p.serviceContexts.get(v)}catch(u){r=u}if((v!=null)&&(t!=null)){clearInterval(n);if(t.swf==null){t.swf=s}l.resolve(t)}else{if(q.expired()){clearInterval(n);l.reject(new Error("SWFService timed out attempting to access the requested SWF."))}}},100);return l.promise};return k})();f=(function(){function k(){this.serviceContextManager=new d()}k.prototype.get=function(l,n,m){var o;if(m==null){m=30000}o=new j(m);return this.serviceContextManager.getBySWFId(l,o.remaining()).then(function(p){return p.get(n,o.remaining())})};k.prototype.onInit=function(l){this.serviceContextManager.add(new a(l))};k.prototype.onServiceRegister=function(n,m,l){this.serviceContextManager.getById(n).onServiceRegister(m,l)};k.prototype.onServiceExecuteComplete=function(p,o,l,n,m){this.serviceContextManager.getById(p).onServiceExecuteComplete(o,l,n,m)};k.prototype.onServiceEvent=function(o,n,l,m){return this.serviceContextManager.getById(o).onServiceEvent(n,l,m)};return k})();h=typeof exports!=="undefined"&&exports!==null?exports:window;h.SWFService=new f()}).call(this);
