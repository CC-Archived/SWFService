/*!
 * [SWFService](http://github.com/CodeCatalyst/SWFService) v2.0.0
 * Copyright (c) 2008-2013 [CodeCatalyst, LLC](http://codecatalyst.com)
 * Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
 */
/*!
 * [promise.coffee](http://github.com/CodeCatalyst/promise.coffee) v1.0
 * Copyright (c) 2012-2013 [CodeCatalyst, LLC](http://www.codecatalyst.com/).
 * Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
 */
(function(){var a,b,f,e,d,c;d=(typeof process!=="undefined"&&process!==null?process.nextTick:void 0)||(typeof setImmediate!=="undefined"&&setImmediate!==null)||function(g){return setTimeout(g,0)};e=function(g){return typeof g==="function"};f=(function(){function g(t,h){var j,q,p,l,s,r,o,i,k,n,m;this.promise=new b(this);o=[];k=false;l=false;r=null;s=null;if(!e(h)){h=function(u){throw u}}n=function(){var v,w,u;for(w=0,u=o.length;w<u;w++){v=o[w];v[s](r)}o=[]};m=function(u){o.push(u);if(l){n()}};j=function(v,u){t=h=null;s=v;r=u;l=true;n()};p=function(u){j("resolve",u)};q=function(u){j("reject",u)};i=function(w,v){k=true;try{if(e(w)){v=w(v)}if(v&&e(v.then)){v.then(p,q)}else{p(v)}}catch(u){q(u)}};this.resolve=function(u){if(!k){i(t,u)}};this.reject=function(u){if(!k){i(h,u)}};this.then=function(w,u){var v;if(e(w)||e(u)){v=new g(w,u);d(function(){return m(v)});return v.promise}return this.promise}}return g})();b=(function(){function g(h){this.then=function(j,i){return h.then(j,i)}}return g})();a=(function(){function g(){var h;h=new f();this.promise=h.promise;this.resolve=function(i){return h.resolve(i)};this.reject=function(i){return h.reject(i)}}return g})();c=typeof exports!=="undefined"&&exports!==null?exports:window;c.Deferred=a;c.defer=function(){return new a()}}).call(this);(function(){var b,e,f,a,d,i,c,g,h;e=(function(){function j(k,l){this.entityClass=k;this.entityKeyProperty=l!=null?l:"id";this.entitiesByKey={}}j.prototype.add=function(k){var l;if(!(k instanceof this.entityClass)){throw new Error("Entity must be of type: "+this.entityClass.name+" to be added to this EntitySet.")}l=k[this.entityKeyProperty];if(this.exists(l)){throw new Error("An Entity with key: "+l+" already exists in this EntitySet.")}this.entitiesByKey[l]=k;return k};j.prototype.remove=function(k){if(this.contains(k)){delete this.entitiesByKey[k[this.entityKeyProperty]];return k}return null};j.prototype.removeAll=function(){this.entitiesByKey={}};j.prototype.get=function(k){return this.entitiesByKey[k]};j.prototype.find=function(k){var l;l=function(m){var o,n;for(o in k){n=k[o];if(m[o]!==n){return false}}return true};return this.match(l)};j.prototype.match=function(m){var k,l,o,n;o=[];n=this.entitiesByKey;for(l in n){k=n[l];if(m(k)){o.push(k)}}return o};j.prototype.contains=function(k){var l;l=k[this.entityKeyProperty];return this.exists(l)&&k===this.get(l)};j.prototype.exists=function(k){return this.entitiesByKey[k]!=null};j.prototype.toArray=function(){var n,k,l,m;n=[];m=this.entitiesByKey;for(l in m){k=m[l];n.push(k)}return n};return j})();b=(function(){function j(k,m,l){this.entityClass=k;this.entityKeyProperty=m!=null?m:"id";this.options=l!=null?l:{};this.entities=new e(this.entityClass);this.pendingEntityRequestsByEntityId={}}j.prototype.get=function(m){var l,k,n,o,p=this;k=this.entities.get(m);if(k!=null){l=new Deferred();l.resolve(k);return l.promise}else{l=new Deferred();if(this.options.timeout!=null){setTimeout(function(){l.reject(new Error("Request for "+p.entityClass.name+" with "+p.entityKeyProperty+": "+m+" timed out."))},timeout)}if((o=(n=this.pendingEntityRequestsByEntityId)[m])==null){n[m]=[]}this.pendingEntityRequestsByEntityId[m].push(l);return l.promise}};j.prototype.register=function(m){var n,l,o,p,k;this.entities.add(m);n=m[this.entityKeyProperty];o=this.pendingEntityRequestsByEntityId[n];for(p=0,k=o.length;p<k;p++){l=o[p];l.resolve(m)}delete this.pendingEntityRequestsByEntityId[n];return m};j.prototype.unregister=function(k){this.entities.remove(k);return k};return j})();g=(function(){function j(z,v,t){var l,k,x,u,r,w,o,n,m,y,B,A,s,q,p;this.id=v;k=function(C){return function(){return z.getServiceProperty(v,C)}};u=function(C){return function(D){z.setServiceProperty(v,C,D)}};x=function(C){return function(){var D;D=Array.prototype.slice.call(arguments);return z.executeServiceMethod(v,C,D)}};s=t.accessors;for(o=0,y=s.length;o<y;o++){l=s[o];Object.defineProperty(this,l.name,{writeable:l.access!=="readonly",get:k(l.name),set:u(l.name)})}q=t.variables;for(n=0,B=q.length;n<B;n++){w=q[n];Object.defineProperty(this,w.name,{get:k(w.name),set:u(w.name)})}p=t.methods;for(m=0,A=p.length;m<A;m++){r=p[m];this[r.name]=x(r.name)}if(t.isEventDispatcher){this.addEventListener=function(E,F,C,D,G){if(C==null){C=false}if(D==null){D=0}if(G==null){G=false}z.addServiceEventListener(v,E,F,C,D,G)};this.removeEventListener=function(D,E,C){if(C==null){C=false}z.removeServiceEventListener(v,D,E,C)}}}return j})();c=(function(){function j(o,n,l,m){var k;this.id=o;this.serviceId=n;this.methodName=l;this.args=m;k=new Deferred();this.promise=k.promise,this.resolve=k.resolve,this.reject=k.reject}return j})();i=(function(){function j(q,o,m,p,k,l,n){this.id=q;this.serviceId=o;this.eventType=m;this.listenerFunction=p;this.useCapture=k!=null?k:false;this.priority=l!=null?l:0;this.useWeakReference=n!=null?n:false}j.prototype.redispatch=function(k){return this.listenerFunction(k)};return j})();a=(function(){function j(k){this.id=k;this.serviceProxyRegistry=new b(g);this.serviceOperationProxies=new e(c);this.serviceEventListenerProxies=new e(i);return}j.prototype.get=function(k){return this.serviceProxyRegistry.get(k)};j.prototype.getServiceDescriptor=function(k){return this.swf.SWFServiceContext_getServiceDescriptor(k)};j.prototype.getServiceProperty=function(l,k){return this.swf.SWFServiceContext_getServiceProperty(l,k)};j.prototype.setServiceProperty=function(m,k,l){this.swf.SWFServiceContext_setServiceProperty(m,k,l)};j.prototype.executeServiceMethod=function(p,l,m){var o,n,k,q=this;n=this.swf.SWFServiceContext_executeServiceMethod(p,l,m);if(n.pending){k=new c(n.operationId,p,l,m);this.serviceOperationProxies.add(k);o=function(){return q.serviceOperationProxies.remove(k)};k.promise.then(o,o);return k.promise}return n.value};j.prototype.addServiceEventListener=function(o,n,p,k,m,q){var l;l=this.swf.SWFServiceContext_addServiceEventListener(o,n,k,m,q);this.serviceEventListenerProxies.add(new i(l,o,n,p,k,m,q))};j.prototype.removeServiceEventListener=function(n,l,o,k){var m;m=this.serviceEventListenerProxies.find({serviceId:n,eventType:l,listenerFunction:o,useCapture:k})[0];if(m!=null){this.swf.SWFServiceContext_removeServiceEventListener(n,m.id);this.serviceEventListenerProxies.remove(m)}};j.prototype.onServiceRegister=function(l,k){this.serviceProxyRegistry.register(new g(this,l,k))};j.prototype.onServiceExecuteComplete=function(o,l,n,m){var k;k=this.serviceOperationProxies.get(l);if(k!=null){k[n](m)}};j.prototype.onServiceEvent=function(m,k,l){return this.serviceEventListenerProxies.get(k).redispatch(l)};return j})();d=(function(){function j(){this.serviceContexts=new e(a)}j.prototype.add=function(k){return this.serviceContexts.add(k)};j.prototype.getById=function(k){return this.serviceContexts.get(k)};j.prototype.getBySWF=function(l){var k,m,n=this;k=new Deferred();m=setInterval(function(){var p,r,q;try{r=l.SWFServiceContext_getId()}catch(o){}if(r!=null){p=n.serviceContexts.get(r);if((q=p.swf)==null){p.swf=l}k.resolve(p);clearInterval(m)}},100);return k.promise};return j})();f=(function(){function j(){this.serviceContextManager=new d()}j.prototype.get=function(k,l){return this.serviceContextManager.getBySWF(k).then(function(m){return m.get(l)})};j.prototype.onInit=function(k){this.serviceContextManager.add(new a(k))};j.prototype.onServiceRegister=function(m,l,k){this.serviceContextManager.getById(m).onServiceRegister(l,k)};j.prototype.onServiceExecuteComplete=function(o,n,k,m,l){this.serviceContextManager.getById(o).onServiceExecuteComplete(n,k,m,l)};j.prototype.onServiceEvent=function(n,m,k,l){return this.serviceContextManager.getById(n).onServiceEvent(m,k,l)};return j})();h=typeof exports!=="undefined"&&exports!==null?exports:window;h.SWFService=new f()}).call(this);
